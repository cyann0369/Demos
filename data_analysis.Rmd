---
title: "Demos Data Analysis Notebook"
output: html_notebook
---
# Demos Data Project

## Imports

```{r}
# read xlsx files
library(readxl)

# aefaefaefaeffaeaef

# tables ?
library(readr)

# Better table graphics
library(reactable)
library(htmltools)

# to save table 
library(xtable)


#global lib
library(tidyverse)
library(dplyr)

# plot graphs
library(ggplot2)

# package for compositional vars dimensionality reduction
library(compositions)

library(caret)  # For train/test split
library(stats) # linear reg 



# package for correlation analysis.
library('corrr')

# plot correlations
library(ggcorrplot)

# Lib for PCA


```

## Data Exploration

```{r}
data <- read_excel("data/data_abs.xlsx")
glimpse(data)
```
### Checking Missing Values

```{r}
colSums(is.na(data))
```

### Visualizing the Data

```{r}
summary(data)

```

```{r}

# Define the bar chart function for use in the table
bar_chart <- function(label, width = "100%", height = "16px", fill = "#15607A", background = "#EEEEEE") {
  bar <- div(style = list(background = fill, width = width, height = height))
  chart <- div(style = list(flexGrow = 1, background = background), bar) #, marginRight = "10px"
  div(style = list(display = "flex", alignItems = "center"), label, chart)
}

# Function to generate the reactable table based on given parameters
generate_reactable_table <- function(data, columns = "all") {
  # If columns is set to "all", use all columns from the dataset
  if (identical(columns, "all")) {
    columns <- names(data)
  }
  
  # Define a dynamic columns list for reactable
  col_definitions <- list()
  
  for (col in columns) {
    # Check if the column is numeric to apply the bar chart, else render normally
    if (is.numeric(data[[col]])) {
      col_definitions[[col]] <- colDef(align = "left", cell = function(value) {
        # Dynamically adjust bar width based on the column's maximum value
        width <- paste0(value / max(data[[col]]) * 100, "%")
        bar_chart(value, width = width)
      })
    } else {
      # Non-numeric columns just display their values as-is
      col_definitions[[col]] <- colDef(align = "left")
    }
  }
  
  # Render the reactable table
  reactable(
    data[, columns, drop = FALSE],  # Select only the specified columns
    columns = col_definitions
  )
}

# Test the function with the Cars93 dataset, displaying the Make, MPG.city, and MPG.highway columns


# Example usage with specific columns
# generate_reactable_table(data, columns = c("Ouvrier", "Employe", "PI", "Cadres", "Artisant", "Agri"))

# Example usage with all columns (default)
generate_reactable_table(data)


```

## Data Analysis


```{r}
library(corrplot)
data_for_corr = data[, !(names(data) %in% c("Department", "Code"))]
corrplot(cor(data_for_corr), type="upper", order="hclust", tl.col="black", tl.srt=45)
```

### Analyse Univarié

```{r}
summary(data$HLM)
```


### Analyse Bivarié


